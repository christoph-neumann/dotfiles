#!/bin/bash

branch="$1"
if [ "$1" == "" ]; then
	ref=$(git symbolic-ref HEAD 2> /dev/null)
	if [ "$?" != "0" ]; then
		echo >&2 "Error: does not appear to be a git repository"
		exit 1
	fi
	ref=${ref#refs/heads/}

	echo -n "Would you like to merge '$ref' into master? (y/n) "
	read finish
	if [ "$finish" = "y" ]; then
		branch="$ref"
	else
		exit 1
	fi
fi

git branch | grep "^..$branch$" 2>&1 >/dev/null
if [ "$?" != "0" ]; then
	echo >&2 "Error: branch does not exist: $branch"
	exit 1
fi

git co master && git pull && git merge --no-ff "$branch"
